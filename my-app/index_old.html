<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MultiLingual</title>
    <style>
        button {
            font-size: 30px;
            padding: 0.25 2rem;
            margin: 1rem;
            width: 10rem;
            cursor: pointer;
        }

        [lang="en"] {
            border: 5px solid #dd0000;
            margin: 1rem;
        }

        [lang="fr"] {
            border: 5px solid limegreen;
            margin: 1rem;
        }

        div[lang] {
            display: none;
        }

        div[lang].lang-match {
            /* background-color: cornflowerblue; */
            display: block;
        }
    </style>
</head>

<body>
    <!-- <form id="langue-select" name="" >
        <select onchange="selectLang()">
            <option value="en-CA">Canadian English</option>
            <option value="de">Deutsh</option>
            <option value="fr-CA">Français</option>
        </select>
    </form> -->
    
    <!-- <form id="selectbox" name="" >
        <select onchange="javascript:location.href = this.value;">
            <option value={{ url('/de') }}>Deutsch</option>
            <option value={{ url('/en') }}>English</option>
        </select>
    </form> -->

    <label for="language-select">Choose your language:</label>
    <select id="language-select" onchange="selectLang()">
        <option value="fr">Français</option>
        <option value="en">English</option>
    </select>

    <div lang="fr">
        <button data-key="btn-yes">Actual</button>
        <button data-key="btn-no">Actual</button>
    </div>
    <div lang="en">
        <button data-key="btn-yes">DEFAULT</button>
        <button data-key="btn-no">DEFAULT</button>
    </div>


    

    <script>
        //language data... could come from an external js/json file
        let langdata = {
            "fr": {
                    "strings": {
                        "btn-yes": "oui",
                        "btn-no": "non"
                    }
                },
            "languages": {
                "en": {
                    "strings": {
                        "btn-yes": "yes",
                        "btn-no": "no"
                    }
                },
            }
        }
    </script>
    <script>
        function loadLanguage() {
            const langSelect = document.getElementById("language-select");
            const savedLang = localStorage.getItem("lang");
            if (savedLang) {
                langSelect.value = savedLang;
        }
}
        function selectLang(){
            let langSelect = document.getElementById('language-select');
            let lang = langSelect.value;
            console.log(lang);
            localStorage.setItem('lang', lang);
            window.location.reload();
        }

        console.log(localStorage.getItem('lang'))




        //apply the language values to the content
        document.addEventListener('DOMContentLoaded', () => {
            //skip the lang value in the HTML tag for this example
            /* let zones = document.querySelectorAll('html [lang]');
            applyStrings(zones); */

            let lang = findLocaleMatch();
            let container = document.querySelector(`html [lang*=${lang}]`);
            container.className = 'lang-match';
        });

        /* function applyStrings(containers) {
            containers.forEach(container => {
                //find all the elements that have data-key
                let locale = container.getAttribute('lang');
                //console.log('looking inside of ', locale);
                container.querySelectorAll(`[data-key]`).forEach(element => {
                    let key = element.getAttribute('data-key');
                    //console.log(element);
                    //console.log(key);
                    let lang = locale.substr(0, 2); //first 2 characters
                    if (key) {
                        element.textContent = langdata.languages[lang].strings[key];
                    }
                });
            })
        } */

        function findLocaleMatch() {
            let keys = Object.keys(langdata.languages); //from our data
            let locales = Intl.getCanonicalLocales(keys); //from our data validated

            //let lang = navigator.language; //from browser 
            let lang = localStorage.getItem('lang');
            console.log('localStorage', lang);
            let locale = Intl.getCanonicalLocales(lang); //from browser validated
            console.log('browser language', lang);
            console.log('locales from data file', locale);

            //find the match for locale inside locales
            let langMatch = document.documentElement.getAttribute('lang'); //default
            locales = locales.filter(l => locale == l);
            langMatch = (locales.length > 0) ? locales[0] : langMatch;
            return langMatch;
        }
    </script>
</body>

</html>